<div id="diagramContainer" style="width:100%; height:600px; overflow:hidden; position:relative;">
    <div class="mermaid" id="diagram">
        sequenceDiagram
        participant Alice
        participant Bob
        Alice->>Bob: Hello Bob, how are you?
        Bob-->>Alice: I am good thanks!
        Alice-)Bob: See you later!
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.13.10/mermaid.min.js"></script>
<script>
    mermaid.initialize({ startOnLoad: false });

    function enableSvgPanZoom(svg) {
        let viewBox = svg.viewBox.baseVal;
        if (!viewBox || viewBox.width === 0 || viewBox.height === 0) {
            const bbox = svg.getBBox();
            svg.setAttribute("viewBox", `0 0 ${bbox.width} ${bbox.height}`);
            viewBox = svg.viewBox.baseVal;
        }

        let panX = 0, panY = 0;
        let scale = 1;
        let isDragging = false;
        let startX, startY;

        svg.addEventListener("wheel", (e) => {
            e.preventDefault();
            const delta = e.deltaY < 0 ? 1.1 : 0.9;
            scale *= delta;
            svg.setAttribute("transform", `scale(${scale}) translate(${panX}, ${panY})`);
            svg.setAttribute("viewBox", `${viewBox.x} ${viewBox.y} ${viewBox.width / scale} ${viewBox.height / scale}`);
        });

        svg.addEventListener("mousedown", (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            svg.style.cursor = "grabbing";
        });

        window.addEventListener("mouseup", () => {
            isDragging = false;
            svg.style.cursor = "grab";
        });

        window.addEventListener("mousemove", (e) => {
            if (!isDragging) return;
            const dx = (e.clientX - startX) * (viewBox.width / svg.clientWidth);
            const dy = (e.clientY - startY) * (viewBox.height / svg.clientHeight);
            startX = e.clientX;
            startY = e.clientY;
            viewBox.x -= dx;
            viewBox.y -= dy;
            svg.setAttribute("viewBox", `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
        });
    }

    window.addEventListener("load", function () {
        mermaid.init(undefined, document.querySelectorAll(".mermaid"));

        // Wait for diagram to render before attaching zoom behavior
        setTimeout(() => {
            const svg = document.querySelector("#diagramContainer svg");
            if (svg) {
                svg.style.cursor = "grab";
                enableSvgPanZoom(svg);
            }
        }, 500); // Delay to ensure SVG is drawn
    });
</script>